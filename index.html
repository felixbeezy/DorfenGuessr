<DorfenGuessr html>
<html>
<head>
    <title>Geo-Spiel</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <style>
        #map {
            height: 500px;
        }

        /* Sichtbarer Distanzzähler */
        #distanceCounter {
            position: absolute;
            top: 10px;
            left: 100px;
            background: white;
            padding: 10px;
            border-radius: 6px;
            font-size: 18px;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>

    <!-- Sichtbarer Zähler -->
    <div id="distanceCounter">Gesamtdistanz: 0 m</div>

    <div id="map"></div>

    <script>
        // --- Karte ---
        var map = L.map('map').setView([48.273561, 12.151746], 13);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
        }).addTo(map);

        // --- Roter Marker für richtige Position ---
        var redIcon = L.icon({
            iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-red.png',
            shadowUrl: 'https://unpkg.com/leaflet@1.7.1/dist/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        // --- 30 Beispiel-Locations ---
        var locations = [
            [48.272553, 12.153901],    //1
            [48.275453, 12.148353],    //2
            [48.270650, 12.157018],    //3
            [48.274148, 12.154584],    //4
            [48.279477, 12.165390],    //5
            [48.269583, 12.155464],    //6
            [48.275589, 12.165335],    //7
            [48.272195, 12.164315],    //8
            [48.275723, 12.151183],    //9
            [48.276657, 12.147139],    //10
            [48.267316, 12.174199],    //11
            [48.274946, 12.154978],    //12
            [48.274541, 12.145647],    //13
            [48.275747, 12.163478],    //14
            [48.272544, 12.167005],    //15
            [48.281387, 12.145996],    //16
            [48.271491, 12.149682],    //17
            [48.273492, 12.157811],    //18
            [48.274602, 12.148605],    //19
            [48.276817, 12.154477],    //20
            [48.277743, 12.144353],    //21
            [48.271701, 12.157579],    //22
            [48.271161, 12.153956],    //23
            [48.273058, 12.150092],    //24
            [48.282358, 12.146647],    //25
            [48.269727, 12.164796],    //26
            [48.274025, 12.150711],    //27
            [48.272722, 12.148374],    //28
            [48.275708, 12.144342],    //29
            [48.275900, 12.167000],    //30
        ];

        var currentRound = 0;
        var guessMarker = null;
        var correctMarker = null;
        var waitingForNextRound = false;

        // --- Gesamtdistanz-Zähler ---
        var totalDistance = 0;

        function updateCounter() {
            document.getElementById("distanceCounter").innerText = 
                "Gesamtdistanz: " + Math.round(totalDistance) + " m";
        }

        alert("Klicke auf die Karte, um Runde 1 zu starten!");

        map.on('click', function(e) {

            // Falls Runde beendet ist → neue Runde starten
            if (waitingForNextRound) {
                waitingForNextRound = false;

                // alte Marker löschen
                if (guessMarker) map.removeLayer(guessMarker);
                if (correctMarker) map.removeLayer(correctMarker);

                currentRound++;

                // Wenn alles fertig ist → Gesamtdistanz anzeigen
                if (currentRound >= locations.length) {
                    alert("Alle Runden abgeschlossen!\n\nGesamtdistanz: " + Math.round(totalDistance) + " Meter");
                    return;
                }

                alert("Runde " + (currentRound + 1) + ": Tippe einen Ort!");
                return;
            }

            // Tipp setzen
            guessMarker = L.marker(e.latlng).addTo(map);

            // Richtige Position holen
            var correctLatLng = L.latLng(
                locations[currentRound][0],
                locations[currentRound][1]
            );

            // Richtige Position anzeigen
            correctMarker = L.marker(correctLatLng, {icon: redIcon}).addTo(map);

            // Distanz berechnen
            var distance = e.latlng.distanceTo(correctLatLng);

            // Gesamtdistanz erhöhen
            totalDistance += distance;
            updateCounter();

            alert(
                "Distanz dieser Runde: " + Math.round(distance) + " Meter\n" +
                "Klicke erneut auf die Karte für die nächste Runde."
            );

            waitingForNextRound = true;
        });
    </script>
</body>
</html>


